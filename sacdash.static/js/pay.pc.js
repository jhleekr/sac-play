let e,t,n,d;function o(){"block"==document.getElementById("qrlock").style.display?(document.getElementById("qrlock").style.display="none",document.getElementById("qr").style.display="block"):(document.getElementById("qrlock").style.display="block",document.getElementById("qr").style.display="none")}function i(){if(document.getElementById("btn1").innerText="결제 대기중",!(t>0)){t=30,document.getElementById("logg").innerText="WAIT(0)",n=document.getElementById("name").value,0==document.getElementById("name").value.length&&(n="--noname"),d=document.getElementById("amnt").value;var e=new XMLHttpRequest;e.onreadystatechange=function(){if(200==this.status&&this.readyState==this.DONE){JSON.parse(e.responseText);document.getElementById("logg").innerText="WAIT(1)",setTimeout(s,1e3)}200!=this.status&&this.readyState==this.DONE&&(document.getElementById("logg").innerText="결제 실패 (0)",document.getElementById("btn1").innerText="결제")},e.open("POST","https://api.sac.today/a/tint",!0),e.setRequestHeader("Authorization","Basic "+getCookie("-sp-admin-sess")),e.send()}}function s(){if(t-=1,t<1)return t=0,document.getElementById("logg").innerText="결제 대기중",void(document.getElementById("btn1").innerText="결제");var e=new XMLHttpRequest;e.onreadystatechange=function(){if(this.readyState==this.DONE){if(201==this.status)return document.getElementById("logg").innerText="스캔 대기중 "+String(t),void setTimeout(s,1e3);if(200==this.status)if(1==(n=JSON.parse(e.responseText)).result)return document.getElementById("logg").innerText="결제 성공",document.getElementById("btn1").innerText="결제",void(t=0);if(400==this.status){var n;if(1==(n=JSON.parse(e.responseText)).detail)return document.getElementById("logg").innerText="결제 실패 (금액 오류)",document.getElementById("btn1").innerText="결제",void(t=0);if(2==n.detail)return document.getElementById("logg").innerText="결제 실패 (토큰 만료)",document.getElementById("btn1").innerText="결제",void(t=0);if(3==n.detail)return document.getElementById("logg").innerText="결제 실패 (잔액 부족)",document.getElementById("btn1").innerText="결제",void(t=0);if(4==n.detail)return document.getElementById("logg").innerText="결제 실패 (항목길이초과)",document.getElementById("btn1").innerText="결제",void(t=0)}return document.getElementById("logg").innerText="서버 오류",document.getElementById("btn1").innerText="결제",void(t=0)}},e.open("POST","https://api.sac.today/a/tpay",!0);var o=new FormData;o.append("name",n),o.append("price",d),e.setRequestHeader("Authorization","Basic "+getCookie("-sp-admin-sess")),e.send(o)}window.addEventListener("usrLoad",(function(e){null===e.detail&&(window.location.href="/landing/");try{var t="https://dash.sac.today/scanner?sid="+getCookie("-sp-admin-sess");bwipjs.toCanvas("qr",{bcid:"qrcode",text:t,scale:15})}catch(e){}document.getElementById("btn1").onclick=function(){i()},document.getElementById("qr").onclick=function(){o()},document.getElementById("qrlock").onclick=function(){o()}}));